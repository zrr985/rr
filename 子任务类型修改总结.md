# 子任务类型修改总结

## 修改背景
根据用户需求，将安全帽检测和吸烟检测分开为两个独立的子任务类型，保留温度检测(SUB_THR)和气体检测(SUB_GAS)。

## 修改内容

### 1. 子任务类型定义修改

**修改前：**
```python
#第四位
SUB_FACE = 0
SUB_METER = 1
SUB_SMOKE_HAT = 2  # 安全帽/吸烟检测（合并）
SUB_INF = 3        # 红外入侵检测
SUB_THR = 4        # 温度检测
SUB_GAS = 5        # 气体检测
```

**修改后：**
```python
#第四位
SUB_FACE = 0
SUB_METER = 1
SUB_HARDHAT = 2    # 安全帽检测（独立）
SUB_INF = 3        # 红外入侵检测
SUB_THR = 4        # 温度检测（保留）
SUB_GAS = 5        # 气体检测（保留）
SUB_SMOKE = 6      # 吸烟检测（独立）
```

### 2. UDP数据帧字段4映射关系

| 任务代号 | 任务名称 | 子任务类型 | 字段4值 | 说明 |
|---------|---------|-----------|---------|------|
| 0 | 人脸识别 | SUB_FACE | 0 | 使用RGB摄像头 |
| 1 | 仪表检测 | SUB_METER | 1 | 使用RGB摄像头 |
| 2 | 安全帽检测 | SUB_HARDHAT | 2 | 使用RGB摄像头 |
| 3 | 红外入侵检测 | SUB_INF | 3 | 使用红外摄像头 |
| 4 | 火焰检测 | SUB_THR | 4 | 使用RGB摄像头 |
| 5 | 吸烟检测 | SUB_SMOKE | 6 | 使用RGB摄像头 |

### 3. 修改的文件列表

1. **main.py** - 主要修改文件
   - 修改子任务类型定义
   - 修改send_abnormal_data函数中的吸烟检测数据帧

2. **maincopy.py** - 备份文件
   - 修改子任务类型定义

3. **main_annotated.py** - 注释版本
   - 修改子任务类型定义
   - 修改send_abnormal_data函数

4. **main_annotated_part1.py** - 注释版本第一部分
   - 修改子任务类型定义

5. **main_annotated_part2.py** - 注释版本第二部分
   - 修改send_abnormal_data函数

### 4. 具体代码修改

#### 4.1 子任务类型定义修改
```python
# 修改前
SUB_SMOKE_HAT = 2  # 安全帽/吸烟检测子任务

# 修改后
SUB_HARDHAT = 2    # 安全帽检测子任务
SUB_SMOKE = 6      # 吸烟检测子任务
```

#### 4.2 send_abnormal_data函数修改
```python
# 安全帽检测（保持不变）
elif task_code == 2:  # 安全帽检测
    data_hardhat = (1, 1, 0, 2, 1, state, 0, 0, 0)  # 字段4=2 (SUB_HARDHAT)

# 吸烟检测（修改字段4）
elif task_code == 5:  # 吸烟检测
    data_smoke = (1, 1, 0, 6, 1, state, 0, 0, 0)    # 字段4=6 (SUB_SMOKE)
```

### 5. 修改影响分析

#### 5.1 正面影响
- **任务分离**：安全帽检测和吸烟检测现在是独立的子任务类型
- **协议清晰**：UDP通信协议更加明确，每个检测任务有独立的标识
- **扩展性**：为未来添加新的检测任务预留了空间
- **维护性**：代码结构更清晰，便于维护和调试

#### 5.2 需要注意的地方
- **外部系统兼容性**：如果外部系统依赖原来的SUB_SMOKE_HAT=2，需要相应更新
- **协议文档**：需要更新UDP通信协议文档
- **测试验证**：需要测试修改后的UDP通信是否正常工作

### 6. 验证建议

1. **功能测试**：测试安全帽检测和吸烟检测的UDP数据推送
2. **协议测试**：验证UDP数据帧的字段4值是否正确
3. **兼容性测试**：确认外部系统能正确解析新的子任务类型
4. **性能测试**：确保修改不影响系统性能

### 7. 总结

本次修改成功将安全帽检测和吸烟检测分离为独立的子任务类型，同时保留了温度检测和气体检测的原有编号。修改涉及多个文件，确保了代码的一致性和完整性。修改后的系统更加模块化，便于后续的维护和扩展。

